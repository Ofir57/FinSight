<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="./img/logo.png">
    <meta name="description" content="××¤×œ×™×§×¦×™×™×ª × ×™×”×•×œ ×¤×™× × ×¡×™ ××™×©×™ - Personal Finance Manager PWA">
    <meta name="theme-color" content="#10b981">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://www.gstatic.com https://apis.google.com; style-src 'self' 'unsafe-inline'; img-src 'self' https: data:; connect-src 'self' https://*.googleapis.com https://*.firebaseio.com https://*.firebaseapp.com wss://*.firebaseio.com; frame-src https://accounts.google.com https://*.firebaseapp.com;">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="./img/logo.png">
    <title>FinSight - × ×™×”×•×œ ×¤×™× × ×¡×™</title>
    <link rel="stylesheet" href="css/app.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="brand">
                    <img src="./img/logo.png" class="brand-icon" alt="FinSight">
                    <span class="brand-name">Fin<span class="brand-highlight">Sight</span></span>
                </div>
            </div>

            <!-- Auth Section injected by auth.js -->

            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="index.html" class="nav-link active" data-category="dashboard">
                            <span class="icon">ğŸ </span>
                            <span data-i18n="nav.dashboard">×“××©×‘×•×¨×“</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="pages/bank.html" class="nav-link" data-category="bank">
                            <span class="icon">ğŸ¦</span>
                            <span data-i18n="nav.bankAccounts">×—×©×‘×•× ×•×ª ×‘× ×§</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="pages/credit.html" class="nav-link" data-category="credit">
                            <span class="icon">ğŸ’³</span>
                            <span data-i18n="nav.creditCards">×›×¨×˜×™×¡×™ ××©×¨××™</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="pages/stocks.html" class="nav-link" data-category="stocks">
                            <span class="icon">ğŸ“ˆ</span>
                            <span data-i18n="nav.stocks">×× ×™×•×ª</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <span class="nav-link" style="cursor: default;">
                            <span class="icon">ğŸ“Š</span>
                            <span data-i18n="nav.financialProducts">××•×¦×¨×™× ×¤×™× × ×¡×™×™×</span>
                        </span>
                        <ul class="nav-submenu">
                            <li class="nav-item">
                                <a href="pages/market-products.html" class="nav-link" data-category="market-products">
                                    <span data-i18n="nav.marketProducts">ğŸª ××•×¦×¨×™× ×‘×©×•×§</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="pages/my-funds.html" class="nav-link" data-category="my-products">
                                    <span data-i18n="nav.myProducts">ğŸ’ ×”××•×¦×¨×™× ×©×œ×™</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a href="pages/assets.html" class="nav-link" data-category="assets">
                            <span class="icon">ğŸ </span>
                            <span data-i18n="nav.assets">× ×›×¡×™×</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="pages/goals.html" class="nav-link" data-category="goals">
                            <span class="icon">ğŸ¯</span>
                            <span data-i18n="nav.goals">×™×¢×“×™ ×—×™×¡×›×•×Ÿ</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="pages/pension-calc.html" class="nav-link" data-category="pension-calc">
                            <span class="icon">ğŸ§®</span>
                            <span data-i18n="nav.pensionCalc">××—×©×‘×•×Ÿ ×¤× ×¡×™×”</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="pages/reports.html" class="nav-link" data-category="reports">
                            <span class="icon">ğŸ“‹</span>
                            <span data-i18n="nav.reports">×“×•×—×•×ª</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="pages/profile.html" class="nav-link" data-category="profile">
                            <span class="icon">ğŸ‘¤</span>
                            <span data-i18n="nav.profile">×¤×¨×•×¤×™×œ ×¤×™× × ×¡×™</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="pages/settings.html" class="nav-link" data-category="settings">
                            <span class="icon">âš™ï¸</span>
                            <span data-i18n="nav.settings">×”×’×“×¨×•×ª</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="sidebar-footer">
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary btn-sm" onclick="ExportManager.showExportOptions()">
                        <span>ğŸ“¤</span>
                        <span data-i18n="common.export">×™×™×¦×•×</span>
                    </button>
                    <button class="btn btn-secondary btn-sm" id="importDataBtn">
                        <span>ğŸ“¥</span>
                        <span data-i18n="common.import">×™×™×‘×•×</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="page-header">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                    <div>
                        <h1 data-i18n="dashboard.title">× ×™×”×•×œ ×¤×™× × ×¡×™ ××™×©×™</h1>
                        <p data-i18n="dashboard.subtitle">×¡×§×™×¨×” ×›×œ×œ×™×ª ×©×œ ×”× ×›×¡×™× ×©×œ×š</p>
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="WidgetManager.showCustomizeModal()" style="white-space: nowrap;">
                        <span>âš™ï¸</span>
                        <span data-i18n="dashboard.customize">×”×ª×××” ××™×©×™×ª</span>
                    </button>
                </div>
            </header>

            <!-- Net Worth Banner -->
            <div class="net-worth-banner" data-widget="netWorth">
                <div class="label" data-i18n="dashboard.netWorth">×©×•×•×™ × ×§×™</div>
                <div class="value" id="netWorthTotal">â‚ª0</div>
            </div>

            <!-- Summary Cards -->
            <div class="summary-grid" data-widget="summaryCards">
                <a href="pages/bank.html" class="summary-card bank">
                    <div class="icon">ğŸ¦</div>
                    <div class="label" data-i18n="dashboard.bankBalance">×™×ª×¨×ª ×‘× ×§</div>
                    <div class="value" id="bankTotal">â‚ª0</div>
                </a>

                <a href="pages/credit.html" class="summary-card credit">
                    <div class="icon">ğŸ’³</div>
                    <div class="label" data-i18n="dashboard.creditExpenses">×”×•×¦××•×ª ××©×¨××™</div>
                    <div class="value" id="creditTotal">â‚ª0</div>
                </a>

                <a href="pages/stocks.html" class="summary-card stocks">
                    <div class="icon">ğŸ“ˆ</div>
                    <div class="label" data-i18n="dashboard.stocksValue">×©×•×•×™ ×× ×™×•×ª</div>
                    <div class="value" id="stocksTotal">â‚ª0</div>
                </a>

                <div class="summary-card funds" onclick="location.href='pages/training.html'">
                    <div class="icon">ğŸ“Š</div>
                    <div class="label" data-i18n="dashboard.fundsValue">×©×•×•×™ ×§×¨× ×•×ª</div>
                    <div class="value" id="fundsTotal">â‚ª0</div>
                </div>

                <a href="pages/assets.html" class="summary-card assets">
                    <div class="icon">ğŸ </div>
                    <div class="label" data-i18n="dashboard.assetsValue">×©×•×•×™ × ×›×¡×™×</div>
                    <div class="value" id="assetsTotal">â‚ª0</div>
                </a>
            </div>

            <!-- Charts Section -->
            <div class="charts-grid">
                <div class="card" data-widget="assetDistribution">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="icon">ğŸ“Š</span>
                            <span data-i18n="dashboard.assetDistribution">×—×œ×•×§×ª × ×›×¡×™×</span>
                        </h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="assetDistributionChart"></canvas>
                    </div>
                </div>

                <div class="card" data-widget="monthlyExpenses">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span class="icon">ğŸ’³</span>
                            <span data-i18n="dashboard.monthlyExpenses">×”×•×¦××•×ª ×—×•×“×©×™×•×ª</span>
                        </h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="monthlyExpensesChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Goals Progress Widget (hidden by default) -->
            <div class="card" data-widget="goalsProgress" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="icon">ğŸ¯</span>
                        <span data-i18n="dashboard.goalsProgress">×”×ª×§×“××•×ª ×™×¢×“×™×</span>
                    </h2>
                </div>
                <div class="card-body" id="goalsProgressWidget">
                    <div style="padding: 20px; text-align: center; color: var(--color-text-secondary);">
                        <a href="pages/goals.html" style="color: var(--color-primary);" data-i18n="dashboard.addSavingsGoals">×”×•×¡×£ ×™×¢×“×™ ×—×™×¡×›×•×Ÿ</a>
                    </div>
                </div>
            </div>

            <!-- Currency Rates Widget (hidden by default) -->
            <div class="card" data-widget="currencyRates" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="icon">ğŸ’±</span>
                        <span data-i18n="dashboard.currencyRates">×©×¢×¨×™ ××˜×‘×¢</span>
                    </h2>
                    <button class="btn btn-sm btn-secondary" onclick="loadCurrencyWidget()">ğŸ”„</button>
                </div>
                <div class="card-body" id="currencyRatesWidget" style="padding: 20px;">
                    <div style="text-align: center; color: var(--color-text-secondary);"><span data-i18n="stocks.loading">×˜×•×¢×Ÿ...</span></div>
                </div>
            </div>

            <!-- Smart Tips Widget (hidden by default) -->
            <div class="card" data-widget="smartTips" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="icon">ğŸ’¡</span>
                        <span data-i18n="dashboard.smartTips">×˜×™×¤×™× ×—×›××™×</span>
                    </h2>
                    <a href="pages/profile.html" class="btn btn-sm btn-secondary" data-i18n="profile.showAllTips">×”×¦×’ ×”×›×œ</a>
                </div>
                <div class="card-body" id="smartTipsWidget">
                </div>
            </div>

            <!-- Quick Stats Widget (hidden by default) -->
            <div class="card" data-widget="quickStats" style="display: none;">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="icon">ğŸ“ˆ</span>
                        <span data-i18n="dashboard.quickStats">×¡×˜×˜×™×¡×˜×™×§×•×ª ××”×™×¨×•×ª</span>
                    </h2>
                </div>
                <div class="card-body">
                    <div class="quick-stats-grid" id="quickStatsWidget">
                        <!-- Will be populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card" data-widget="recentTransactions">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="icon">ğŸ“‹</span>
                        <span data-i18n="dashboard.recentTransactions">×¤×¢×•×œ×•×ª ××—×¨×•× ×•×ª</span>
                    </h2>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th data-i18n="common.date">×ª××¨×™×š</th>
                                <th data-i18n="common.type">×¡×•×’</th>
                                <th data-i18n="common.name">×ª×™××•×¨</th>
                                <th data-i18n="common.amount">×¡×›×•×</th>
                            </tr>
                        </thead>
                        <tbody id="recentTransactions">
                            <!-- Will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle">â˜°</button>

        <!-- Mobile Language Toggle (always visible) -->
        <div class="mobile-lang-switcher">
            <button class="lang-btn" data-lang="he" onclick="I18n.setLanguage('he')">HE</button>
            <button class="lang-btn" data-lang="en" onclick="I18n.setLanguage('en')">EN</button>
            <button class="lang-btn" data-lang="pt" onclick="I18n.setLanguage('pt')">PT</button>
        </div>
    </div>

    <script src="js/storage.js"></script>
    <script src="js/pin-lock.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/alerts.js"></script>
    <script src="js/goals.js"></script>
    <script src="js/tags.js"></script>
    <script src="js/export.js"></script>
    <script src="js/smart-tips.js"></script>
    <script src="js/widgets.js"></script>
    <script src="js/currency.js"></script>
    <script src="js/data-updates.js"></script>
    <script src="js/app.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/crypto.js"></script>
    <script src="js/auth.js"></script>
    <script src="data/sample-data.js"></script>
    <script>
        // Dashboard specific initialization
        document.addEventListener('DOMContentLoaded', () => {
            App.currentPage = 'dashboard';
            WidgetManager.init();
            App.updateDashboard();
            Charts.updateMonthlyExpenses();
            loadRecentTransactions();
        });

        function loadRecentTransactions() {
            const transactions = [];

            // Get recent bank balance updates
            const bankAccounts = Storage.getBankAccounts();
            bankAccounts.forEach(acc => {
                if (acc.history && acc.history.length > 0) {
                    const latest = acc.history[acc.history.length - 1];
                    transactions.push({
                        date: latest.date,
                        type: I18n.t('nav.bankAccounts'),
                        description: acc.nameHe || acc.nameEn || acc.bank,
                        amount: latest.balance,
                        isPositive: true
                    });
                }
            });

            // Get recent expenses
            const creditData = Storage.getCreditCards();
            creditData.expenses.slice(-5).forEach(exp => {
                transactions.push({
                    date: exp.date,
                    type: I18n.t('nav.creditCards'),
                    description: exp.description,
                    amount: -exp.amount,
                    isPositive: false
                });
            });

            // Get recent stock transactions
            const stockData = Storage.getStocks();
            stockData.transactions.slice(-5).forEach(tx => {
                transactions.push({
                    date: tx.date,
                    type: I18n.t('nav.stocks'),
                    description: `${tx.type === 'buy' ? I18n.t('stocks.buy') : I18n.t('stocks.sell')} ${tx.symbol}`,
                    amount: tx.type === 'buy' ? -tx.price * tx.quantity : tx.price * tx.quantity,
                    isPositive: tx.type === 'sell'
                });
            });

            // Sort by date and take last 10
            transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            const recent = transactions.slice(0, 10);

            // Render table
            const tbody = document.getElementById('recentTransactions');
            if (recent.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" style="text-align: center; color: var(--color-text-secondary);">${I18n.t('common.noData')}</td></tr>`;
                return;
            }

            tbody.innerHTML = recent.map(tx => `
                <tr>
                    <td>${I18n.formatDate(tx.date)}</td>
                    <td>${tx.type}</td>
                    <td>${tx.description}</td>
                    <td class="${tx.isPositive ? 'positive' : 'negative'}">${I18n.formatCurrency(Math.abs(tx.amount))}</td>
                </tr>
            `).join('');
        }

        // Load goals progress widget
        function loadGoalsProgressWidget() {
            const widget = document.getElementById('goalsProgressWidget');
            if (!widget || !WidgetManager.isEnabled('goalsProgress')) return;

            try {
                const goals = JSON.parse(localStorage.getItem('finance_goals') || '[]');
                if (goals.length === 0) {
                    widget.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: var(--color-text-secondary);">
                            <a href="pages/goals.html" style="color: var(--color-primary);">${I18n.t('dashboard.addSavingsGoals')}</a>
                        </div>
                    `;
                    return;
                }

                widget.innerHTML = goals.slice(0, 3).map(goal => {
                    const progress = Math.min(100, (goal.currentAmount / goal.targetAmount) * 100);
                    return `
                        <div style="margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>${goal.name}</span>
                                <span>${progress.toFixed(0)}%</span>
                            </div>
                            <div style="background: var(--color-bg-hover); border-radius: 4px; height: 8px; overflow: hidden;">
                                <div style="width: ${progress}%; height: 100%; background: var(--color-primary); border-radius: 4px;"></div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (e) {
                console.error('Error loading goals widget:', e);
            }
        }

        // Load quick stats widget
        function loadQuickStatsWidget() {
            const widget = document.getElementById('quickStatsWidget');
            if (!widget || !WidgetManager.isEnabled('quickStats')) return;

            const bankAccounts = Storage.getBankAccounts();
            const creditData = Storage.getCreditCards();
            const stockData = Storage.getStocks();
            const fundsData = Storage.getFunds();

            // Calculate stats
            const thisMonth = new Date().getMonth();
            const thisMonthExpenses = creditData.expenses
                .filter(e => new Date(e.date).getMonth() === thisMonth)
                .reduce((sum, e) => sum + e.amount, 0);

            const lastMonth = thisMonth === 0 ? 11 : thisMonth - 1;
            const lastMonthExpenses = creditData.expenses
                .filter(e => new Date(e.date).getMonth() === lastMonth)
                .reduce((sum, e) => sum + e.amount, 0);

            const expenseChange = lastMonthExpenses > 0
                ? ((thisMonthExpenses - lastMonthExpenses) / lastMonthExpenses * 100).toFixed(0)
                : 0;

            const stocksTotal = stockData.holdings.reduce((sum, h) => sum + (h.quantity * (h.currentPrice || h.avgPrice)), 0);
            const stocksCost = stockData.holdings.reduce((sum, h) => sum + (h.quantity * h.avgPrice), 0);
            const stocksReturn = stocksCost > 0 ? ((stocksTotal - stocksCost) / stocksCost * 100).toFixed(1) : 0;

            const fundsTotal = fundsData.reduce((sum, f) => sum + f.currentValue, 0);
            const fundsMonthlyDeposit = fundsData.reduce((sum, f) => sum + (f.monthlyDeposit || 0), 0);

            widget.innerHTML = `
                <style>
                    .quick-stats-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                        gap: 15px;
                        padding: 15px;
                    }
                    .quick-stat-item {
                        text-align: center;
                        padding: 15px;
                        background: var(--color-bg-hover);
                        border-radius: 10px;
                    }
                    .quick-stat-item .label {
                        font-size: 0.8rem;
                        color: var(--color-text-secondary);
                        margin-bottom: 5px;
                    }
                    .quick-stat-item .value {
                        font-size: 1.2rem;
                        font-weight: 600;
                    }
                    .quick-stat-item .change {
                        font-size: 0.75rem;
                        margin-top: 3px;
                    }
                    .quick-stat-item .change.positive { color: var(--color-positive); }
                    .quick-stat-item .change.negative { color: var(--color-negative); }
                </style>
                <div class="quick-stat-item">
                    <div class="label">${I18n.t('dashboard.monthExpenses')}</div>
                    <div class="value">${I18n.formatCurrency(thisMonthExpenses)}</div>
                    <div class="change ${expenseChange > 0 ? 'negative' : 'positive'}">${expenseChange > 0 ? 'â–²' : 'â–¼'} ${Math.abs(expenseChange)}% ${I18n.t('dashboard.fromLastMonth')}</div>
                </div>
                <div class="quick-stat-item">
                    <div class="label">${I18n.t('dashboard.stockReturn')}</div>
                    <div class="value ${stocksReturn >= 0 ? 'positive' : 'negative'}">${stocksReturn >= 0 ? '+' : ''}${stocksReturn}%</div>
                </div>
                <div class="quick-stat-item">
                    <div class="label">${I18n.t('dashboard.bankAccountsCount')}</div>
                    <div class="value">${bankAccounts.length}</div>
                </div>
                <div class="quick-stat-item">
                    <div class="label">${I18n.t('dashboard.monthlyFundDeposit')}</div>
                    <div class="value">${I18n.formatCurrency(fundsMonthlyDeposit)}</div>
                </div>
            `;
        }

        // Load currency rates widget
        async function loadCurrencyWidget() {
            const widget = document.getElementById('currencyRatesWidget');
            if (!widget || !WidgetManager.isEnabled('currencyRates')) return;

            widget.innerHTML = '<div style="text-align: center; color: var(--color-text-secondary);">' + I18n.t('stocks.loading') + '</div>';

            try {
                const rates = await CurrencyRates.getRates();

                widget.innerHTML = `
                    <style>
                        .currency-rates-grid {
                            display: grid;
                            grid-template-columns: repeat(3, 1fr);
                            gap: 15px;
                        }
                        .rate-card {
                            text-align: center;
                            padding: 15px;
                            background: var(--color-bg-hover);
                            border-radius: 10px;
                        }
                        .rate-card .flag {
                            font-size: 2rem;
                            margin-bottom: 5px;
                        }
                        .rate-card .code {
                            font-size: 0.8rem;
                            color: var(--color-text-secondary);
                        }
                        .rate-card .rate {
                            font-size: 1.3rem;
                            font-weight: 600;
                            color: var(--color-primary);
                        }
                    </style>
                    <div class="currency-rates-grid">
                        <div class="rate-card">
                            <div class="flag">ğŸ‡ºğŸ‡¸</div>
                            <div class="code">USD</div>
                            <div class="rate">â‚ª${rates.USD.toFixed(2)}</div>
                        </div>
                        <div class="rate-card">
                            <div class="flag">ğŸ‡ªğŸ‡º</div>
                            <div class="code">EUR</div>
                            <div class="rate">â‚ª${rates.EUR.toFixed(2)}</div>
                        </div>
                        <div class="rate-card">
                            <div class="flag">ğŸ‡¬ğŸ‡§</div>
                            <div class="code">GBP</div>
                            <div class="rate">â‚ª${rates.GBP.toFixed(2)}</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 10px; font-size: 0.75rem; color: var(--color-text-secondary);">
                        ${I18n.t('dashboard.updated')}: ${new Date().toLocaleTimeString('he-IL')}
                    </div>
                `;
            } catch (e) {
                widget.innerHTML = '<div style="text-align: center; color: var(--color-negative);">' + I18n.t('dashboard.rateLoadError') + '</div>';
            }
        }

        // Load smart tips widget
        function loadSmartTipsWidget() {
            const widget = document.getElementById('smartTipsWidget');
            if (!widget || !WidgetManager.isEnabled('smartTips')) return;

            const tips = SmartTips.generateTips();
            const lang = I18n?.currentLanguage || 'he';

            if (tips.length === 0) {
                widget.innerHTML = `<div style="padding: 20px; text-align: center; color: var(--color-text-secondary);">
                    <a href="pages/profile.html" style="color: var(--color-primary);">${lang === 'he' ? '××œ× ×¤×¨×•×¤×™×œ ×œ×§×‘×œ×ª ×˜×™×¤×™×' : 'Fill your profile to get tips'}</a>
                </div>`;
                return;
            }

            tips.sort((a, b) => a.priority - b.priority);
            widget.innerHTML = tips.slice(0, 3).map(tip => `
                <div style="display: flex; gap: 12px; padding: 12px 15px; border-bottom: 1px solid var(--color-border);">
                    <span style="font-size: 1.3rem;">${tip.icon}</span>
                    <div>
                        <div style="font-weight: 500; margin-bottom: 2px;">${tip.title[lang] || tip.title.he}</div>
                        <div style="font-size: 0.85rem; color: var(--color-text-secondary);">${tip.description[lang] || tip.description.he}</div>
                    </div>
                </div>
            `).join('');
        }

        // Update widget loading on dashboard load
        document.addEventListener('DOMContentLoaded', () => {
            loadGoalsProgressWidget();
            loadQuickStatsWidget();
            loadCurrencyWidget();
            loadSmartTipsWidget();
        });
    </script>
</body>
</html>
<!-- Mon Feb  2 18:38:29 -03 2026 -->
