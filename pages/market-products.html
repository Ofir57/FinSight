<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#00d2ff">
    <link rel="manifest" href="../manifest.json">
    <link rel="icon" type="image/png" href="../img/logo.png">
    <title>××•×¦×¨×™× ×‘×©×•×§ - FinSight</title>
    <link rel="stylesheet" href="../css/app.css">
    <style>
        .nav-link.active { background: #00d2ff !important; color: #1a1a2e !important; }
        .page-header h1 { color: #00d2ff; }

        .product-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .product-tab {
            padding: 10px 20px;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-md);
            background: var(--color-bg-secondary);
            color: var(--color-text-primary);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .product-tab:hover { border-color: #00d2ff; }

        .product-tab.active {
            background: #00d2ff;
            border-color: #00d2ff;
            color: #1a1a2e;
        }

        /* Source toggle */
        .source-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .source-tab {
            padding: 8px 16px;
            border: 1px solid var(--color-border);
            border-radius: 20px;
            background: transparent;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }

        .source-tab:hover { border-color: #00d2ff; color: #00d2ff; }

        .source-tab.active {
            background: rgba(0, 210, 255, 0.15);
            border-color: #00d2ff;
            color: #00d2ff;
        }

        .source-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.85rem;
            color: var(--color-text-secondary);
        }

        .source-info a { color: #00d2ff; text-decoration: none; }

        /* My products */
        .my-products-section {
            background: var(--color-bg-card);
            border: 1px solid rgba(0, 210, 255, 0.3);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 25px;
        }

        .my-products-section h3 {
            color: #00d2ff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .my-product-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: var(--color-bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: 8px;
            border: 1px solid var(--color-border);
        }

        .my-product-card .name { font-weight: 600; }
        .my-product-card .company { font-size: 0.85rem; color: var(--color-text-secondary); }
        .my-product-card .value { font-weight: 700; color: #00d2ff; font-size: 1.1rem; }

        .my-products-empty { text-align: center; color: var(--color-text-secondary); padding: 20px; }
        .my-products-link { display: inline-block; margin-top: 10px; color: #00d2ff; text-decoration: none; font-size: 0.9rem; }
        .my-products-link:hover { text-decoration: underline; }

        /* Stats row */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--color-bg-card);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--color-border);
        }

        .stat-card h3 { color: var(--color-text-secondary); font-size: 0.9rem; margin-bottom: 10px; }

        .stat-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(90deg, #00d2ff, #3a7bd5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Winners / Analysis */
        .analysis-section {
            background: linear-gradient(135deg, rgba(0, 210, 255, 0.1) 0%, rgba(58, 123, 213, 0.1) 100%);
            border: 2px solid #00d2ff;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .analysis-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #00d2ff;
        }

        .winners-grid { display: flex; flex-direction: column; gap: 15px; }

        .winner-card {
            background: rgba(0, 210, 255, 0.15);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .winner-card.second { background: rgba(192, 192, 192, 0.1); }
        .winner-card.third { background: rgba(205, 127, 50, 0.1); }

        .winner-badge {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #1a1a2e;
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .winner-badge.silver { background: linear-gradient(135deg, #c0c0c0, #a8a8a8); }
        .winner-badge.bronze { background: linear-gradient(135deg, #cd7f32, #b87333); }

        .winner-info { flex: 1; min-width: 200px; }
        .winner-name { font-size: 1.3rem; font-weight: bold; color: #fff; margin-bottom: 5px; }
        .winner-company { color: var(--color-text-secondary); font-size: 0.95rem; }

        .winner-stats { display: flex; gap: 15px; flex-wrap: wrap; }

        .winner-stat {
            text-align: center;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .winner-stat-value { font-size: 1.2rem; font-weight: bold; color: #00ff88; }
        .winner-stat-label { font-size: 0.75rem; color: var(--color-text-secondary); margin-top: 3px; }

        .analysis-note {
            margin-top: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--color-text-secondary);
            border-right: 3px solid #00d2ff;
        }

        /* 4 tables grid */
        .tables-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .table-block {
            background: var(--color-bg-card);
            border-radius: 16px;
            padding: 20px;
            overflow-x: auto;
            border: 1px solid var(--color-border);
        }

        .table-block .section-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-block .section-title .icon { font-size: 1.5rem; }
        .table-block .sort-indicator { font-size: 0.9rem; color: #00d2ff; margin-right: auto; }

        .table-block table { width: 100%; border-collapse: collapse; }

        .table-block th, .table-block td {
            padding: 12px 10px;
            text-align: right;
            border-bottom: 1px solid var(--color-border);
        }

        .table-block th {
            background: rgba(0, 210, 255, 0.1);
            color: #00d2ff;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .table-block th.sorted { background: rgba(0, 210, 255, 0.25); }
        .table-block tr:hover { background: rgba(255, 255, 255, 0.05); }

        .rank { width: 40px; text-align: center; }
        .rank-1 { color: #ffd700; font-weight: bold; }
        .rank-2 { color: #c0c0c0; font-weight: bold; }
        .rank-3 { color: #cd7f32; font-weight: bold; }

        .positive { color: #00ff88; }
        .negative { color: #ff4757; }
        .performance { font-weight: 600; font-size: 1.05rem; }

        .fund-name { font-weight: 500; }
        .company-cell { color: var(--color-text-secondary); font-size: 0.85rem; }

        /* Full table with search */
        .full-table-section { margin-bottom: 25px; }

        .search-box {
            width: 100%;
            padding: 10px 15px;
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            color: var(--color-text-primary);
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        .search-box::placeholder { color: var(--color-text-secondary); }
        .search-box:focus { outline: none; border-color: #00d2ff; }

        .full-table { overflow-x: auto; }

        .full-table table { width: 100%; border-collapse: collapse; }

        .full-table th {
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
            padding: 12px 10px;
            background: rgba(0, 210, 255, 0.1);
            color: #00d2ff;
            font-weight: 600;
            font-size: 0.85rem;
            text-align: right;
            border-bottom: 1px solid var(--color-border);
        }

        .full-table th:hover { color: #fff; }
        .full-table th .sort-arrow { margin-right: 4px; font-size: 0.7rem; }

        .full-table td {
            padding: 12px 10px;
            white-space: nowrap;
            text-align: right;
            border-bottom: 1px solid var(--color-border);
        }

        .full-table tr:hover { background: rgba(255, 255, 255, 0.05); }

        .no-data-msg { text-align: center; color: var(--color-text-secondary); padding: 40px 20px; }

        @media (max-width: 1200px) {
            .tables-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .table-block th, .table-block td { padding: 8px 6px; font-size: 0.8rem; }
            .stat-card .value { font-size: 1.4rem; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="brand">
                    <img src="../img/logo.png" class="brand-icon" alt="FinSight">
                    <span class="brand-name">Fin<span class="brand-highlight">Sight</span></span>
                </div>
            </div>

            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="../index.html" class="nav-link" data-category="dashboard">
                            <span class="icon">ğŸ </span>
                            <span data-i18n="nav.dashboard">×“××©×‘×•×¨×“</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="bank.html" class="nav-link" data-category="bank">
                            <span class="icon">ğŸ¦</span>
                            <span data-i18n="nav.bankAccounts">×—×©×‘×•× ×•×ª ×‘× ×§</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="credit.html" class="nav-link" data-category="credit">
                            <span class="icon">ğŸ’³</span>
                            <span data-i18n="nav.creditCards">×›×¨×˜×™×¡×™ ××©×¨××™</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="stocks.html" class="nav-link" data-category="stocks">
                            <span class="icon">ğŸ“ˆ</span>
                            <span data-i18n="nav.stocks">×× ×™×•×ª</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <span class="nav-link" style="cursor: default;">
                            <span class="icon">ğŸ“Š</span>
                            <span>××•×¦×¨×™× ×¤×™× × ×¡×™×™×</span>
                        </span>
                        <ul class="nav-submenu">
                            <li class="nav-item">
                                <a href="market-products.html" class="nav-link active" data-category="market-products">
                                    <span>ğŸª</span><span>××•×¦×¨×™× ×‘×©×•×§</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="my-funds.html" class="nav-link" data-category="my-products">
                                    <span>ğŸ’</span><span>×”××•×¦×¨×™× ×©×œ×™</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a href="assets.html" class="nav-link" data-category="assets">
                            <span class="icon">ğŸ </span>
                            <span data-i18n="nav.assets">× ×›×¡×™×</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="sidebar-footer">
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="logo-hero">
                <img src="../img/logo.png" alt="FinSight" class="logo-hero-img">
            </div>
            <header class="page-header">
                <h1>
                    <span>ğŸª</span>
                    <span>××•×¦×¨×™× ×‘×©×•×§</span>
                </h1>
            </header>

            <!-- Product Type Tabs -->
            <div class="product-tabs">
                <button class="product-tab active" data-tab="training" onclick="switchTab('training', this)">ğŸ“ ×§×¨×Ÿ ×”×©×ª×œ××•×ª</button>
                <button class="product-tab" data-tab="pension" onclick="switchTab('pension', this)">ğŸ›ï¸ ×¤× ×¡×™×”</button>
                <button class="product-tab" data-tab="gemel" onclick="switchTab('gemel', this)">ğŸ’¼ ×§×•×¤×ª ×’××œ</button>
                <button class="product-tab" data-tab="savings" onclick="switchTab('savings', this)">ğŸ· ×¤×•×œ×™×¡×ª ×—×™×¡×›×•×Ÿ</button>
            </div>

            <!-- Source Toggle -->
            <div class="source-tabs">
                <button class="source-tab active" onclick="switchSource('themarker', this)">TheMarker / ××œ×˜×©×•×œ×¨</button>
                <button class="source-tab" onclick="switchSource('igemel', this)">iGemel-Net</button>
            </div>

            <div class="source-info">
                <span id="sourceLabel">××§×•×¨: TheMarker SuperMarker</span>
                <a id="sourceLink" href="#" target="_blank">×œ××ª×¨ ×”××§×•×¨</a>
            </div>

            <!-- My Products Section -->
            <div class="my-products-section">
                <h3>
                    <span>ğŸ’</span>
                    <span id="myProductsTitle">×”××•×¦×¨×™× ×©×œ×™ - ×§×¨×Ÿ ×”×©×ª×œ××•×ª</span>
                </h3>
                <div id="myProductsList"></div>
                <a href="my-funds.html" class="my-products-link">× ×™×”×•×œ ×”××•×¦×¨×™× ×©×œ×™ &larr;</a>
            </div>

            <!-- Dynamic content container -->
            <div id="dynamicContent"></div>

            <!-- No data message -->
            <div id="noDataMsg" class="no-data-msg" style="display: none;">
                <p>××™×Ÿ × ×ª×•× ×™ ×©×•×§ ×–××™× ×™× ×œ×¡×•×’ ××•×¦×¨ ×–×”</p>
            </div>
        </main>
    </div>

    <script src="../data/market-funds.js"></script>
    <script src="../data/mygemel-funds.js"></script>
    <script src="../js/storage.js"></script>
    <script src="../js/i18n.js"></script>
    <script src="../js/app.js"></script>
    <script>
        let currentTab = 'training';
        let currentSource = 'themarker';
        let fullSortCol = 'year5';
        let fullSortDir = -1;

        const tabLabels = {
            training: '×§×¨×Ÿ ×”×©×ª×œ××•×ª',
            pension: '×¤× ×¡×™×”',
            gemel: '×§×•×¤×ª ×’××œ',
            savings: '×¤×•×œ×™×¡×ª ×—×™×¡×›×•×Ÿ'
        };

        function switchTab(tab, btn) {
            currentTab = tab;
            document.querySelectorAll('.product-tab').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('myProductsTitle').textContent = '×”××•×¦×¨×™× ×©×œ×™ - ' + tabLabels[tab];
            fullSortCol = 'year5';
            fullSortDir = -1;
            renderAll();
        }

        function switchSource(source, btn) {
            currentSource = source;
            document.querySelectorAll('.source-tab').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderAll();
        }

        function getMarketData() {
            if (currentTab === 'savings') return [];
            if (currentSource === 'themarker') return MarketFunds.getData(currentTab) || [];
            return MyGemelFunds.getData(currentTab) || [];
        }

        function renderAll() {
            updateSourceInfo();
            renderMyProducts();
            renderAnalysis();
        }

        function updateSourceInfo() {
            if (currentSource === 'themarker') {
                document.getElementById('sourceLabel').textContent = '××§×•×¨: TheMarker SuperMarker | ×¢×“×›×•×Ÿ: ' + (MarketFunds.getLastUpdate() || '');
                document.getElementById('sourceLink').href = MarketFunds.getSourceUrl(currentTab) || '#';
            } else {
                document.getElementById('sourceLabel').textContent = '××§×•×¨: iGemel-Net | ×¢×“×›×•×Ÿ: ' + (MyGemelFunds.getLastUpdate() || '');
                document.getElementById('sourceLink').href = (MyGemelFunds.meta.sourceUrls[currentTab]) || '#';
            }
        }

        // ========= My Products =========
        function renderMyProducts() {
            const container = document.getElementById('myProductsList');
            let funds = [];
            try { funds = JSON.parse(localStorage.getItem('finance_my_funds') || '[]'); } catch (e) { }
            const filtered = funds.filter(f => f.type === currentTab);
            if (filtered.length === 0) {
                container.innerHTML = '<div class="my-products-empty">×œ× ×”×•×¡×¤×ª ×¢×“×™×™×Ÿ ××•×¦×¨×™× ××¡×•×’ ×–×”. <a href="my-funds.html" style="color:#00d2ff;">×”×•×¡×£ ×“×¨×š ×”××•×¦×¨×™× ×©×œ×™</a></div>';
                return;
            }
            container.innerHTML = filtered.map(f => {
                const val = f.value ? 'â‚ª' + Number(f.value).toLocaleString() : '';
                return `<div class="my-product-card"><div><div class="name">${f.name || ''}</div><div class="company">${f.company || ''}</div></div><div class="value">${val}</div></div>`;
            }).join('');
        }

        // ========= Analysis Rendering =========
        function fmtPct(v, primary) {
            if (v === null || v === undefined) return '<span style="color: var(--color-text-secondary);">-</span>';
            const cls = v >= 0 ? 'positive' : 'negative';
            const bold = primary ? ' performance' : '';
            return `<span class="${cls}${bold}">${v.toFixed(2)}%</span>`;
        }

        function rankClass(r) { return r <= 3 ? 'rank-' + r : ''; }

        function renderAnalysis() {
            const data = getMarketData();
            const container = document.getElementById('dynamicContent');
            const noData = document.getElementById('noDataMsg');

            if (data.length === 0) {
                container.innerHTML = '';
                noData.style.display = 'block';
                if (currentTab === 'savings') {
                    noData.innerHTML = '<p>ğŸ· ××™×Ÿ × ×ª×•× ×™ ×©×•×§ ×–××™× ×™× ×¢×‘×•×¨ ×¤×•×œ×™×¡×•×ª ×—×™×¡×›×•×Ÿ.<br>× ×™×ª×Ÿ ×œ× ×”×œ ××ª ×”×¤×•×œ×™×¡×•×ª ×©×œ×š ×“×¨×š <a href="my-funds.html" style="color:#00d2ff;">×”××•×¦×¨×™× ×©×œ×™</a></p>';
                } else {
                    noData.innerHTML = '<p>××™×Ÿ × ×ª×•× ×™× ×–××™× ×™×</p>';
                }
                return;
            }

            noData.style.display = 'none';

            // Stats
            const maxMonth = Math.max(...data.map(f => f.month || 0));
            const maxYear1 = Math.max(...data.map(f => f.year1 || 0));
            const y5Data = data.filter(f => f.year5 != null);
            const maxYear5 = y5Data.length ? Math.max(...y5Data.map(f => f.year5)) : 0;

            let html = `<div class="stats-row">
                <div class="stat-card"><h3>×¡×”"×› ×§×¨× ×•×ª</h3><div class="value">${data.length}</div></div>
                <div class="stat-card"><h3>×ª×©×•××” ×—×•×“×©×™×ª ××•×‘×™×œ×”</h3><div class="value">${maxMonth.toFixed(2)}%</div></div>
                <div class="stat-card"><h3>×ª×©×•××” ×©× ×ª×™×ª ××•×‘×™×œ×”</h3><div class="value">${maxYear1.toFixed(2)}%</div></div>
                <div class="stat-card"><h3>×ª×©×•××” ××•×‘×™×œ×” 5 ×©× ×™×</h3><div class="value">${maxYear5.toFixed(2)}%</div></div>
            </div>`;

            // Winners (top 3 by 5-year)
            const top3 = [...data].filter(f => f.year5 != null).sort((a, b) => b.year5 - a.year5).slice(0, 3);
            const icons = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
            const places = ['××§×•× ×¨××©×•×Ÿ', '××§×•× ×©× ×™', '××§×•× ×©×œ×™×©×™'];
            const badges = ['winner-badge', 'winner-badge silver', 'winner-badge bronze'];
            const cards = ['winner-card', 'winner-card second', 'winner-card third'];

            if (top3.length > 0) {
                html += `<div class="analysis-section">
                    <h2 class="analysis-title"><span>ğŸ†</span><span>× ×™×ª×•×—: ×”×§×¨× ×•×ª ×”××•×‘×™×œ×•×ª</span></h2>
                    <div class="winners-grid">`;

                top3.forEach((f, i) => {
                    html += `<div class="${cards[i]}">
                        <div class="${badges[i]}"><span>${icons[i]}</span><span>${places[i]}</span></div>
                        <div class="winner-info">
                            <div class="winner-name">${f.nameHe || f.nameEn}</div>
                            <div class="winner-company">${f.companyHe || f.companyEn}</div>
                        </div>
                        <div class="winner-stats">
                            <div class="winner-stat"><div class="winner-stat-value">${f.year5?.toFixed(2) || '-'}%</div><div class="winner-stat-label">5 ×©× ×™×</div></div>
                            <div class="winner-stat"><div class="winner-stat-value">${f.year3?.toFixed(2) || '-'}%</div><div class="winner-stat-label">3 ×©× ×™×</div></div>
                            <div class="winner-stat"><div class="winner-stat-value">${f.year1?.toFixed(2) || '-'}%</div><div class="winner-stat-label">×©× ×”</div></div>
                            <div class="winner-stat"><div class="winner-stat-value">${f.month?.toFixed(2) || '-'}%</div><div class="winner-stat-label">×—×•×“×©</div></div>
                        </div>
                    </div>`;
                });

                const topCompany = top3[0]?.companyHe || top3[0]?.companyEn || '';
                const srcName = currentSource === 'themarker' ? 'TheMarker' : 'iGemel-Net';
                html += `</div>
                    <div class="analysis-note">×”×“×™×¨×•×’ ××‘×•×¡×¡ ×¢×œ ×‘×™×¦×•×¢×™× ×œ××•×¨×š ×›×œ ×”×ª×§×•×¤×•×ª. ××§×•×¨: ${srcName}.</div>
                </div>`;
            }

            // 4 sorted tables (top 5 each)
            const sortConfigs = [
                { key: 'year5', icon: 'ğŸ†', label: '×××•×™×Ÿ ×œ×¤×™ 5 ×©× ×™×', cols: ['year5', 'year3', 'year1', 'month'], headers: ['5 ×©× ×™× â–¼', '3 ×©× ×™×', '×©× ×”', '×—×•×“×©'] },
                { key: 'year3', icon: 'ğŸš€', label: '×××•×™×Ÿ ×œ×¤×™ 3 ×©× ×™×', cols: ['year3', 'year5', 'year1', 'month'], headers: ['3 ×©× ×™× â–¼', '5 ×©× ×™×', '×©× ×”', '×—×•×“×©'] },
                { key: 'year1', icon: 'ğŸ“ˆ', label: '×××•×™×Ÿ ×œ×¤×™ ×©× ×” ××—×¨×•× ×”', cols: ['year1', 'year5', 'year3', 'month'], headers: ['×©× ×” â–¼', '5 ×©× ×™×', '3 ×©× ×™×', '×—×•×“×©'] },
                { key: 'month', icon: 'ğŸ“…', label: '×××•×™×Ÿ ×œ×¤×™ ×—×•×“×© ××—×¨×•×Ÿ', cols: ['month', 'year5', 'year3', 'year1'], headers: ['×—×•×“×© â–¼', '5 ×©× ×™×', '3 ×©× ×™×', '×©× ×”'] }
            ];

            html += '<div class="tables-grid">';
            sortConfigs.forEach(cfg => {
                const sorted = [...data].filter(f => f[cfg.key] != null).sort((a, b) => b[cfg.key] - a[cfg.key]).slice(0, 5);
                html += `<div class="table-block">
                    <h2 class="section-title"><span class="icon">${cfg.icon}</span><span>${cfg.label}</span><span class="sort-indicator">â–¼</span></h2>
                    <table><thead><tr>
                        <th class="rank">#</th><th>×©× ×§×¨×Ÿ</th><th>×—×‘×¨×”</th>`;
                cfg.headers.forEach((h, i) => {
                    html += `<th${i === 0 ? ' class="sorted"' : ''}>${h}</th>`;
                });
                html += `</tr></thead><tbody>`;
                sorted.forEach((f, idx) => {
                    const r = idx + 1;
                    html += `<tr>
                        <td class="rank ${rankClass(r)}">${r}</td>
                        <td><div class="fund-name">${f.nameHe || f.nameEn}</div></td>
                        <td class="company-cell">${f.companyHe || f.companyEn}</td>`;
                    cfg.cols.forEach((col, i) => { html += `<td>${fmtPct(f[col], i === 0)}</td>`; });
                    html += '</tr>';
                });
                html += '</tbody></table></div>';
            });
            html += '</div>';

            // Full sortable table with search
            html += `<div class="full-table-section card">
                <div class="card-header"><h2 class="card-title"><span class="icon">ğŸ“‹</span><span>×›×œ ×”×§×¨× ×•×ª - ×˜×‘×œ×” ××œ××”</span></h2></div>
                <div style="padding: 0 20px;">
                    <input type="text" class="search-box" id="searchBox" placeholder="×—×™×¤×•×© ×§×¨×Ÿ..." oninput="renderFullTable()">
                </div>
                <div class="full-table" style="padding: 0 20px 20px;">
                    <table>
                        <thead><tr>
                            <th onclick="sortFull('name')"># ×©× ×”×§×¨×Ÿ <span class="sort-arrow"></span></th>
                            <th onclick="sortFull('company')">×—×‘×¨×” <span class="sort-arrow"></span></th>
                            <th onclick="sortFull('month')">×—×•×“×© <span class="sort-arrow"></span></th>
                            <th onclick="sortFull('year1')">×©× ×” <span class="sort-arrow"></span></th>
                            <th onclick="sortFull('year3')">3 ×©× ×™× <span class="sort-arrow"></span></th>
                            <th onclick="sortFull('year5')">5 ×©× ×™× <span class="sort-arrow"></span></th>
                            <th onclick="sortFull('fee')">×“××™ × ×™×”×•×œ <span class="sort-arrow"></span></th>
                        </tr></thead>
                        <tbody id="fullTableBody"></tbody>
                    </table>
                </div>
            </div>`;

            container.innerHTML = html;
            renderFullTable();
        }

        // ========= Full Table =========
        function renderFullTable() {
            const data = getMarketData();
            const tbody = document.getElementById('fullTableBody');
            if (!tbody) return;

            const sorted = [...data].sort((a, b) => {
                if (fullSortCol === 'name') return fullSortDir * (a.nameHe || '').localeCompare(b.nameHe || '', 'he');
                if (fullSortCol === 'company') return fullSortDir * (a.companyHe || '').localeCompare(b.companyHe || '', 'he');
                return fullSortDir * ((a[fullSortCol] ?? -Infinity) - (b[fullSortCol] ?? -Infinity));
            });

            const q = (document.getElementById('searchBox')?.value || '').trim().toLowerCase();
            const filtered = q ? sorted.filter(f =>
                (f.nameHe || '').includes(q) || (f.nameEn || '').toLowerCase().includes(q) ||
                (f.companyHe || '').includes(q) || (f.companyEn || '').toLowerCase().includes(q)
            ) : sorted;

            tbody.innerHTML = filtered.map((f, i) => {
                const fee = f.fee != null ? f.fee.toFixed(2) + '%' : '-';
                return `<tr>
                    <td>${i + 1}. ${f.nameHe || f.nameEn || ''}</td>
                    <td class="company-cell">${f.companyHe || f.companyEn || ''}</td>
                    <td>${fmtPct(f.month)}</td>
                    <td>${fmtPct(f.year1)}</td>
                    <td>${fmtPct(f.year3)}</td>
                    <td>${fmtPct(f.year5)}</td>
                    <td>${fee}</td>
                </tr>`;
            }).join('');

            // Sort arrows
            document.querySelectorAll('.full-table th .sort-arrow').forEach(el => el.textContent = '');
            const ths = document.querySelectorAll('.full-table th');
            const colMap = ['name', 'company', 'month', 'year1', 'year3', 'year5', 'fee'];
            colMap.forEach((col, idx) => {
                if (col === fullSortCol) {
                    const arrow = ths[idx]?.querySelector('.sort-arrow');
                    if (arrow) arrow.textContent = fullSortDir === -1 ? ' â–¼' : ' â–²';
                }
            });
        }

        function sortFull(col) {
            if (fullSortCol === col) fullSortDir *= -1;
            else { fullSortCol = col; fullSortDir = -1; }
            renderFullTable();
        }

        // ========= Init =========
        renderAll();
    </script>
</body>
</html>
